version: '3.8'

services:
  # Service A: Automated Scraper & Data Migration Pipeline
  pipeline:
    build: .
    image: jewelry-pipeline:latest
    volumes:
      # Mount sensitive credentials as Read-Only for security
      - ./config:/app/config:ro
      # Mount data directory to persist scraped results and database updates
      - ./data:/app/data
    # Executes the default CMD ["python", "main.py"] defined in the Dockerfile

    # Service B: Jupyter Lab Environment for Data Analytics
  analysis:
    build: .
    image: jewelry-pipeline:latest
    ports:
      # Map container port 8888 to host port 8888 for browser access
      - "8888:8888"
    volumes:
      # Mount the entire project root to allow real-time code editing and persistence
      - .:/app
    environment:
      # Define an access token for Jupyter Lab security (optional)
      - JUPYTER_TOKEN=demo
    # Override Dockerfile CMD to launch Jupyter Lab as a web server
    command: jupyter lab --ip=0.0.0.0 --no-browser --allow-root --ServerApp.token='demo'
