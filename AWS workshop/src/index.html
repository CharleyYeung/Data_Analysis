<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Cloudy's Weather Center</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            background: #f4f4f4;
        }

        .container {
            margin-top: 50px;
            background: white;
            padding: 20px;
            display: inline-block;
            border-radius: 10px;
        }

        img {
            width: 300px;
            border-radius: 50%;
        }

        #data-box {
            margin-top: 20px;
            color: #333;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Cloudy's Weather Center</h1>
        <img src="images/cloudy.jpg" alt="MyCatCloudy">

        <div id="data-box">
            <h3>ETL Latest Result: </h3>
            <p id="status">Loading data from AWS S3 ...</p>
            <ul id="city-list" style="list-style: none; padding: 0;"></ul>
        </div>
    </div>

    <script>
        const statusElement = document.getElementById('status');
        const cityListElement = document.getElementById('city-list');

        /**
         * Fetches transformed weather data and updates the UI
         */
        async function loadWeatherData() {
            try {
                // 1. Fetch the JSON generated by the ETL pipeline
                // Path is relative to the current directory
                const response = await fetch('data/weather_data.json');

                if (!response.ok) {
                    throw new Error('Network response was not ok or file missing');
                }

                const data = await response.json();

                // 2. Data visualization: clear loading status
                statusElement.style.display = 'none';

                // 3. Iterate through data and inject into DOM
                data.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.style.marginBottom = "15px";

                    const dateHeader = index === 0 ? `<div style="font-weight: bold; margin-bottom: 10px;">Updated on: ${item.date}</div>` : '';

                    li.innerHTML = `
                        ${dateHeader}
                        <div>
                            <strong>${item.city}</strong>: ${item.temperature} <br>
                            <span style="color: #555;">${item.status}</span>
                        </div>
                    `;
                    cityListElement.appendChild(li);
                });

                console.log("Success: Data loaded from ETL output.");

            } catch (error) {
                // Display error in UI for monitoring
                statusElement.innerText = "Error: " + error.message;
                console.error("Critical Failure: UI synchronization failed.", error);
            }
        }

        // Initialize data fetch on page load
        loadWeatherData();
    </script>
</body>

</html>